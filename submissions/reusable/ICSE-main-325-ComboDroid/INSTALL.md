# Install ComboDroid  

Source code repository: [![DOI](https://zenodo.org/badge/DOI/10.5281/zenodo.3666313.svg)](https://doi.org/10.5281/zenodo.3666313)  

Virtual machine repository: [![DOI](https://zenodo.org/badge/DOI/10.5281/zenodo.3673079.svg)](https://doi.org/10.5281/zenodo.3673079)  

  
## 1. TL;DR (Linux or Windows, Using Pre-build VM Image)

Download the [VirtualBox VM Image](https://doi.org/10.5281/zenodo.3673079) and import it (click "File -> Import Appliance" menu item and select the `ova` file; the import process may take a few minutes). Test subjects are also shipped with the VM image for reproducing experimental results.

**Important Notes**:

* It is mandatory to use VirtualBox >= 6.1.2 with nested virtualization.
* On Windows hosts (even with latest VirtualBox), the performance would slightly hurt. The artifact still works.
* The VM image consumes lots of disk space (~30 GiB).
* If you see a `BrokenSharedFolder` warning at VM booting, just ignore it.

## 2 Build from Source Code (Linux)

The source code is available at [this link](https://doi.org/10.5281/zenodo.3666313).

**Dependencies**: JDK-1.8 and Android SDK. If you have AndroidStudio installed, all dependencies are just set.

**Source Code Repository Overview**:

- The `Client` directory containing source code for the client of ComboDroid deployed on the Android device to generate and send events;  
- The `Controller` directory containing source code for the controller of ComboDroid running on the computer to control the client;  
- The build.sh file that can be used to compile and build the artifact; and  
- The README.md file containing instructions to build the tool (all contents are also included in this section).  

### 2.1 Setting Up

Before building, make sure that the path to the d8 compiler of the Android SDK exists in the `PATH` environment variable, which is normally at `[SDK_LOCATION]/build-tools/29.0.3`. Try `d8` in bash to test if `PATH` is set correctly.

To build the artifact, we need to build two jar files, namely a controller jar named `ComboDroid.jar` and a client jar named `client.jar`.
We provide a build script `build.sh` to build these two jars. 
We first introduce how to build with `build.sh` and then how to build manually.

### 2.2 Build

To build the tool, at the source code directory run:

```bash  
./build.sh  
```

A correct build generates `client.jar` and `ComboDroid.jar` at the source code directory  `ComboDroid`.

### 2.3 Notes

`build.sh` consists of the following two parts. On error, please refer to the error messages from gradlew or `d8`.

**ComboDroid (Controller)** :

```bash  
cd Controller  
./gradlew jar
cp build/libs/ComboDroid-1.0-SNAPSHOT.jar ../ComboDroid.jar
```    
The jar file will be generated by Gradle and copied to `ComboDroid.jar`.

**Build the Client**:

```bash  
cd Client
./gradlew jar  
d8 build/libs/client-1.0-SNAPSHOT.jar --output ../client.jar  
```  

The jar file will be first generated by Gradle,  
and then processed by the d8 compiler to generate the final jar file with dex files inside.  
The `--output` option of the command is used to specify the location and name of the final jar.  
The above command will generate the `client.jar` file at the source code directory  `ComboDroid`.
